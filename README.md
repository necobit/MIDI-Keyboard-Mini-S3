# MIDI-Keyboard-Mini-S3

M5StampS3 を使用したコンパクトな MIDI キーボード基板用プログラム

## 概要

このプロジェクトは、M5StampS3 マイコンを使用して MIDI キーボードを実装するためのファームウェアです。物理的な鍵盤スイッチから MIDI 信号を生成し、標準的な MIDI 機器と接続して演奏することができます。

## 主な機能

- **鍵盤入力**: 13 個の鍵盤スイッチ（1 オクターブ + 1 音）に対応
- **MIDI 入出力**: 標準的な MIDI IN/OUT ポートを搭載
- **PWM 音声出力**: 該当する音程の周波数を PWM で出力
- **オクターブシフト**: オクターブアップ/ダウンボタンで音域を変更可能
- **拡張スイッチ**: 追加機能用のスイッチ（CU、CD、S1-S3）を搭載

## ピン配置

### MIDI 通信

- **GPIO13 (MO)**: MIDI OUT - Serial1 の TX ピン
- **GPIO15 (MI)**: MIDI IN - Serial1 の RX ピン

### 鍵盤スイッチ

| ラベル | 機能                | MIDI ノート番号 |
| ------ | ------------------- | --------------- |
| KC     | C 音                | 60              |
| KC#    | C#音                | 61              |
| KD     | D 音                | 62              |
| KD#    | D#音                | 63              |
| KE     | E 音                | 64              |
| KF     | F 音                | 65              |
| KF#    | F#音                | 66              |
| KG     | G 音                | 67              |
| KG#    | G#音                | 68              |
| KA     | A 音                | 69              |
| KA#    | A#音                | 70              |
| KB     | B 音                | 71              |
| KC+    | 次オクターブの C 音 | 72              |

### 制御スイッチ

- **OU**: オクターブアップ（+12）
- **OD**: オクターブダウン（-12）
- **CU, CD, S1-S3**: 拡張機能用スイッチ

### その他

- **PWM**: 音声出力ピン

## 動作仕様

### スイッチ入力

- 全てのスイッチはプルアップ設定
- キー押下時に GND にショート
- ボタンを押すとノートオン、離すとノートオフを送信

### オクターブ制御

- ノート番号の範囲: 0 ～ 127
- KC（ノート 60）が下限を下回らないよう制限
- KC+（ノート 72）が 127 を超えないよう制限

### PWM 音声出力

- 押された鍵盤に対応する周波数を生成
- MIDI 送信と同時に音声出力

## 必要なハードウェア

- M5StampS3
- MIDI キーボード基板（本プロジェクト用）
- 鍵盤スイッチ × 13
- 制御スイッチ × 5
- MIDI コネクタ（DIN 5 ピン）× 2
- 必要に応じて音声出力用のアンプ/スピーカー

## 開発環境

- Arduino IDE または PlatformIO
- M5StampS3 用のボードサポートパッケージ
- MIDI ライブラリ

## インストール

1. Arduino IDE または PlatformIO をインストール
2. M5StampS3 のボードサポートを追加
3. 必要なライブラリをインストール
   - MIDI Library
4. このリポジトリをクローン
5. スケッチを M5StampS3 に書き込み

## 使用方法

1. MIDI キーボード基板に M5StampS3 を接続
2. MIDI OUT 端子を音源機器の MIDI IN に接続
3. 電源を供給
4. 鍵盤を押して演奏

## 回路図

`docs/StampS3.png`に接続図が含まれています。

## ライセンス

[ライセンス情報を追加してください]

## 作者

necobit

## 関連プロジェクト

- [M5Stack-MIDI-Module](https://github.com/necobit/M5Stack-MIDI-Module)
- [GROVE-MIDI-UNIT](https://github.com/necobit/GROVE-MIDI-UNIT)

## サポート

問題や質問がある場合は、GitHub の Issues ページでお知らせください。

## 謝辞

このプロジェクトは、MIDI ライブラリおよび M5Stack コミュニティの貢献に基づいています。
