これは M5StampS3 を使った MIDI キーボード基板用のプログラムです。
docs/StampS3.png
StampS3 に繋がるピンの機能を図示しています。
MO/GPIO13:MIDI OUT、Serial1 の TX ピンをアサインします
MI/GPIO1:MIDI IN、Serial1 の RX ピンをアサインします
「K\*」のラベルが付いているものは鍵盤の音程を示しています。
KC は MIDI の C、ノートナンバー 60 です。
KC#は C#、ノートナンバー 61
KC+はオクターブ上の C、つまりノートナンバー 72 です。
ボタンを押すとノートオン、話すとノートオフを送信します。
OU はオクターブアップ、送信するノートを+12 します。
OD はオクターブダウン、送信するノートを-12 します。
上限が 127 のため、一番高い音(KC+)が 127 を超えないように上限を設定します。
加減は 0 です。同様に KC がそれを下回らないようにします。
CU,CD,S1-S3 は拡張スイッチです。
PWM は音声出力です。該当する音程の周波数を PWM で出力します。
各スイッチはプルアップ、キーが押されると GND にショートします。
鍵盤を弾くと該当した MIDI ノートを送信しながら、PWM から該当する周波数を出力するコードを書いてください。
